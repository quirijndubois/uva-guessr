<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UvA Guessr</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #00000070;
            color: white;
        }

        a {
            text-decoration: none;
            color: rgb(255, 255, 255);
        }

        a:hover {
            color: rgb(76, 91, 255);
        }

        iframe {
            border-radius: 20px;
            transition: transform 0.3s;
            transform-origin: bottom right;
        }

        iframe:hover {
            transform: scale(2);
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #panorama {
            width: 100%;
            height: 100%;
        }

        .title-box {
            border-radius: 20px;
            background-color: #00000061;
            padding: 10px;
        }

        .mini-box {
            border-radius: 15px;
            background-color: #00000061;
            padding: 10px;
        }
    </style>
</head>

<body>

    <div id="panorama"></div>
    <script>
        // Function to fetch a random subfolder from rooms.txt
        function getRandomSubfolder(callback) {
            fetch('rooms.txt')
                .then(response => response.text())
                .then(data => {
                    const subfolders = data.trim().split('\n').filter(Boolean); // Filter out empty lines
                    const randomIndex = Math.floor(Math.random() * subfolders.length);
                    const randomSubfolder = subfolders[randomIndex];
                    callback(randomSubfolder); 
                })
                .catch(error => {
                    console.error('Error fetching subfolders:', error);
                    callback(null);
                });
        }

        // Get a random subfolder and set it as the basePath
        getRandomSubfolder(function (randomSubfolder) {
            if (randomSubfolder) {
                pannellum.viewer('panorama', {
                    "type": "multires",
                    "multiRes": {
                        "basePath": "images/" + randomSubfolder.trim(), // Modify basePath here
                        "path": "/%s%y_%x",
                        "fallbackPath": "/fallback/%s",
                        "extension": "jpg",
                        "tileResolution": 512,
                        "maxLevel": 1,
                        "cubeResolution": 10000
                    }
                });
            } else {
                console.error('Failed to get random subfolder.');
            }
        });
    </script>

    <iframe src="menu.html" frameborder="0" width="225" height="300"
        style="position: fixed; bottom: 10px; right: 10px;"></iframe>

    <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); text-align: center;">
        <h1 class="title-box">UvA Guessr</h1>
    </div>
    <div style="position: absolute; top: 10px; right: 10px; text-align: left;" class="mini-box">
        <a href=" https://github.com/quirijndubois/uva-guessr" target="_blank">View on GitHub</a>
    </div>

    <div style="position: absolute; bottom: 10px; left: 10px; text-align: left;" class="mini-box">
        <a href="https://quirijndubois.nl" target="_blank">by Quirijn du Bois</a>
    </div>

    <div style="position: absolute; top: 10px; left: 40px; text-align: left;" class="mini-box">
        <a href="https://github.com/quirijndubois/uva-guessr/issues/new" target="_blank">Report a bug</a>
    </div>
</body>

</html>